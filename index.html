<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guessinga</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            margin: 0;
            overflow-y: auto;
            flex-direction: column;
            background: linear-gradient(135deg, #2c3e50 0%, #1a252f 100%);
            color: #ecf0f1;
        }

        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding: 20px;
            background-color: #1E1E1E;
            border-radius: 16px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
            margin-top: 20px;
            border: 4px solid #333;
            max-width: 900px;
            width: 100%;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #BB86FC;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            margin: 0;
        }

        .welcome-text {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #c3cfe2;
        }

        .game-status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            font-size: 1.1rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 4px;
            font-weight: 700;
        }

        .game-area {
            position: relative;
            width: 100%;
            padding-top: 56.25%; /* 16:9 Aspect Ratio */
            background-color: #242424;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.3);
            border: 2px solid #333;
        }

        .shape-container {
            position: absolute;
            opacity: 0;
            will-change: transform, opacity;
            animation: shape-in-and-settle 1.5s forwards;
        }

        .shape-svg {
            width: 100%;
            height: 100%;
        }

        @keyframes shape-in-and-settle {
            0% {
                opacity: 0;
                transform: scale(0.2) translate(var(--initial-x), var(--initial-y)) rotate(var(--initial-rotation));
            }
            70% {
                opacity: 1;
                transform: scale(1) translate(var(--intermediate-x), var(--intermediate-y)) rotate(var(--intermediate-rotation));
            }
            100% {
                opacity: 1;
                transform: scale(1) translate(0, 0) rotate(var(--final-rotation));
            }
        }
        
        .game-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .guess-input-container {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            max-width: 400px;
            gap: 0.5rem;
        }
        
        #user-guess {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #4B4B4B;
            border-radius: 8px;
            padding: 12px 24px;
            color: #ecf0f1;
            text-align: center;
            font-size: 1.1rem;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.3);
            outline: none;
        }
        
        #user-guess:focus {
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.3), 0 0 0 3px #BB86FC;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .button {
            padding: 12px 24px;
            font-size: 1em;
            font-weight: 700;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            color: #1E1E1E;
            background: linear-gradient(145deg, #BB86FC, #6200EE);
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        .button:active {
            transform: translateY(0);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }
        
        #start-game-button {
             background: linear-gradient(145deg, #A8E890, #5Dcb5A);
        }
        
        .message-box {
            background-color: #1E1E1E;
            color: #BB86FC;
            font-weight: bold;
            padding: 1rem;
            border-radius: 12px;
            border: 2px solid #333;
            margin-top: 10px;
            min-height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        #game-over-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(30, 30, 30, 0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        #game-over-screen h2 {
            font-size: 3rem;
            color: #FF6B6B;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        #game-over-screen p {
            font-size: 1.5rem;
            margin-top: 1rem;
        }

        .instructions-section {
            background-color: #1E1E1E;
            border-radius: 16px;
            border: 4px solid #333;
            padding: 20px;
            text-align: left;
            margin-top: 20px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
            max-width: 900px;
            width: 100%;
            color: #c3cfe2;
        }
        
        .instructions-section h2 {
            color: #BB86FC;
            text-align: center;
        }
        
        .instructions-section ul {
             padding-left: 20px;
             margin: 5px 0;
        }
        
        #topLeftLogo {
            position: absolute;
            top: 15px;
            left: 15px;
            width: 150px;
            z-index: 20;
        }

        #topRightLogo {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 150px;
            z-index: 20;
        }

        #topLeftLogo img, #topRightLogo img {
            width: 100%;
            height: auto;
        }

        #topLeftLogo .tagline {
            font-size: 16px;
            font-style: italic;
            color: #c3cfe2;
            text-align: center;
            margin-top: 5px;
            width: 100%;
            white-space: nowrap;
            overflow: visible;
            text-overflow: unset;
        }

        @media (max-width: 600px) {
            #topLeftLogo, #topRightLogo {
                width: 100px;
            }
        }


        /* SVG shapes as a sprite to avoid multiple definitions */
        #svg-sprite {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Logos and Tagline -->
    <div id="topLeftLogo">
        <img src="/Guessinga/images/Logo-Guessinga.png" alt="Guessinga Logo">
        <div class="tagline">Eye or Instinct?</div>
    </div>
    <div id="topRightLogo">
        <img src="/Guessinga/images/Logo-FiouriT.png" alt="Company Logo">
    </div>

    <div id="svg-sprite">
        <svg xmlns="http://www.w3.org/2000/svg" width="0" height="0">
            <!-- Star shape -->
            <symbol id="star" viewBox="0 0 100 100">
                <path d="M50,0 L61.8,38.2 L100,38.2 L69.1,61.8 L80.9,100 L50,76.4 L19.1,100 L30.9,61.8 L0,38.2 L38.2,38.2 Z"/>
            </symbol>
            <!-- Square shape -->
            <symbol id="square" viewBox="0 0 100 100">
                <rect x="0" y="0" width="100" height="100" />
            </symbol>
            <!-- Hexagon shape -->
            <symbol id="hexagon" viewBox="0 0 100 100">
                <polygon points="50,0 100,25 100,75 50,100 0,75 0,25" />
            </symbol>
            <!-- Rectangle shape -->
            <symbol id="rectangle" viewBox="0 0 100 100">
                <rect x="0" y="25" width="100" height="50" />
            </symbol>
            <!-- Parallelogram shape -->
            <symbol id="parallelogram" viewBox="0 0 100 100">
                <polygon points="20,0 100,0 80,100 0,100" />
            </symbol>
            <!-- Rhombus shape -->
            <symbol id="rhombus" viewBox="0 0 100 100">
                <polygon points="50,0 100,50 50,100 0,50" />
            </symbol>
            <!-- Triangle shape -->
            <symbol id="triangle" viewBox="0 0 100 100">
                <polygon points="50,0 100,100 0,100" />
            </symbol>
            <!-- Circle shape -->
            <symbol id="circle" viewBox="0 0 100 100">
                <circle cx="50" cy="50" r="50" />
            </symbol>
            <!-- Ellipse shape -->
            <symbol id="ellipse" viewBox="0 0 100 100">
                <ellipse cx="50" cy="50" rx="50" ry="30" />
            </symbol>
        </svg>
    </div>

    <div id="welcome-screen" class="game-container">
        <h1>Welcome to Guessinga!</h1>
        <p class="welcome-text">The ultimate object-counting challenge! Your goal is simple: count the number of shapes that appear on the screen before the time runs out. The game is designed to test your visual perception and quick thinking.</p>
        <button id="start-game-button" class="button">Start Game</button>
    </div>

    <div id="game-screen" class="game-container hidden">
        <div class="game-status-bar">
            <div id="level-display">Level: 1</div>
            <div id="chances-display">Chances: 3</div>
            <div id="timer-display">Time: 4s</div>
        </div>
        
        <div id="game-area" class="game-area">
            <div id="game-over-screen" class="hidden">
                <h2>Game Over!</h2>
                <p id="final-score">You ran out of chances!</p>
                <button id="restart-game-button" class="button mt-4">Restart Game</button>
            </div>
        </div>

        <div class="game-controls">
            <div class="guess-input-container">
                <input type="number" id="user-guess" placeholder="Your guess..." class="flex-grow">
            </div>
            <div class="button-group">
                <button id="submit-button" class="button">Submit</button>
            </div>
            <div id="message-box" class="message-box"></div>
        </div>
        
        <div class="instructions-section">
            <h2 class="text-xl font-bold mb-2">Game Instructions</h2>
            <p>Welcome to **Guessinga**, the ultimate object-counting challenge! Your goal is simple: count the number of shapes that appear on the screen before the time runs out. The game is designed to test your visual perception and quick thinking.</p>
            <p>
                **Game Mechanics:**
                <ul class="text-left list-disc list-inside mt-2 space-y-1">
                    <li>**Levels:** The game has a total of 50 levels. Each level increases in difficulty by adding more shapes and new types of shapes.</li>
                    <li>**Counting:** After the shapes appear and animate, they will become static. Your task is to quickly and accurately count the total number of shapes.</li>
                    <li>**Guessing:** Enter your guess in the input box and click the **"Submit"** button.</li>
                    <li>**Chances:** You start with 3 chances. Each incorrect guess costs you a chance. If you submit a wrong answer three times, the game is over.</li>
                    <li>**Time Limit:** You have 4 seconds to submit a guess. If you run out of time, the game is over.</li>
                    <li>**Difficulty Progression:** The number of shapes and their complexity will gradually increase. At higher levels, shapes may appear smaller, move faster, or be more irregular, making it a true test of your counting skills.</li>
                </ul>
                <p class="mt-2">Good luck, and have fun!</p>
            </p>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const welcomeScreen = document.getElementById('welcome-screen');
            const gameScreen = document.getElementById('game-screen');
            const startButton = document.getElementById('start-game-button');
            const submitButton = document.getElementById('submit-button');
            const restartButton = document.getElementById('restart-game-button');
            const gameOverScreen = document.getElementById('game-over-screen');
            
            const gameArea = document.getElementById('game-area');
            
            const levelDisplay = document.getElementById('level-display');
            const chancesDisplay = document.getElementById('chances-display');
            const timerDisplay = document.getElementById('timer-display');
            const userGuessInput = document.getElementById('user-guess');
            const messageBox = document.getElementById('message-box');
            
            let level = 1;
            let chances = 3;
            let shapesToCount = 0;
            let timer = 0;
            let timerInterval;
            let gameActive = false;
            let isCountingPhase = false;
            
            const shapeTypes = ['star', 'square', 'hexagon', 'rectangle', 'parallelogram', 'rhombus', 'triangle', 'circle', 'ellipse'];
            const colors = ['#f72585', '#b5179e', '#7209b7', '#560bad', '#480ca8', '#3a0ca3', '#3f37c9', '#4361ee', '#4895ef', '#4cc9f0'];

            const displayMessage = (msg, color = '#BB86FC') => {
                messageBox.style.color = color;
                messageBox.textContent = msg;
            };

            const clearShapes = () => {
                // Remove all shape elements from the game area
                const shapes = gameArea.querySelectorAll('.shape-container');
                shapes.forEach(shape => shape.remove());
            };

            const generateShapes = () => {
                clearShapes();
                
                // Reset chances for the new level
                chances = 3;
                
                // Number of shapes is now more unpredictable and increases with difficulty
                // It's a non-linear progression to prevent easy guessing
                const baseShapes = 5;
                const levelFactor = Math.log(level) * 3; // Logarithmic increase
                const randomness = Math.floor(Math.random() * (level / 2 + 1));
                shapesToCount = baseShapes + Math.floor(levelFactor) + randomness;
                shapesToCount = Math.max(shapesToCount, 5); // Ensure at least 5 shapes
                
                // Shape sizes decrease slightly with level
                const minSize = Math.max(20, 60 - level);
                const maxSize = Math.max(40, 80 - level);
                
                const generatedShapes = [];
                const maxAttempts = 100;

                // Function to check for overlap
                const checkOverlap = (newShape, existingShapes, padding) => {
                    for (const existing of existingShapes) {
                        const dx = newShape.x - existing.x;
                        const dy = newShape.y - existing.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        // Using a simple circle-based distance check for simplicity
                        if (distance < (newShape.size / 2 + existing.size / 2 + padding)) {
                            return true;
                        }
                    }
                    return false;
                };

                for (let i = 0; i < shapesToCount; i++) {
                    let newShape = null;
                    let attempts = 0;
                    
                    while (!newShape && attempts < maxAttempts) {
                        const shapeSize = Math.random() * (maxSize - minSize) + minSize;
                        
                        // Set final positions
                        const finalX = Math.random() * (gameArea.clientWidth - shapeSize) + shapeSize / 2;
                        const finalY = Math.random() * (gameArea.clientHeight - shapeSize) + shapeSize / 2;
                        
                        const candidateShape = {
                            x: finalX,
                            y: finalY,
                            size: shapeSize,
                            type: shapeTypes[Math.floor(Math.random() * shapeTypes.length)],
                            color: colors[Math.floor(Math.random() * colors.length)],
                            initialX: Math.random() * (gameArea.clientWidth * 1.5) - (gameArea.clientWidth * 0.25),
                            initialY: Math.random() * (gameArea.clientHeight * 1.5) - (gameArea.clientHeight * 0.25),
                            intermediateX: Math.random() * (gameArea.clientWidth * 1.5) - (gameArea.clientWidth * 0.25),
                            intermediateY: Math.random() * (gameArea.clientHeight * 1.5) - (gameArea.clientHeight * 0.25),
                            initialRotation: `${Math.random() * 360}deg`,
                            intermediateRotation: `${Math.random() * 360}deg`,
                            finalRotation: `${Math.random() * 360}deg`
                        };

                        // Check for overlap with a small padding
                        if (!checkOverlap(candidateShape, generatedShapes, 15)) {
                            newShape = candidateShape;
                        }
                        
                        attempts++;
                    }

                    if (newShape) {
                        generatedShapes.push(newShape);
                        const shapeContainer = document.createElement('div');
                        shapeContainer.className = 'shape-container';
                        shapeContainer.style.width = `${newShape.size}px`;
                        shapeContainer.style.height = `${newShape.size}px`;
                        
                        // Set CSS custom properties for animation
                        shapeContainer.style.left = `${newShape.x - newShape.size / 2}px`;
                        shapeContainer.style.top = `${newShape.y - newShape.size / 2}px`;
                        shapeContainer.style.setProperty('--initial-x', `${newShape.initialX - newShape.x}px`);
                        shapeContainer.style.setProperty('--initial-y', `${newShape.initialY - newShape.y}px`);
                        shapeContainer.style.setProperty('--intermediate-x', `${newShape.intermediateX - newShape.x}px`);
                        shapeContainer.style.setProperty('--intermediate-y', `${newShape.intermediateY - newShape.y}px`);
                        shapeContainer.style.setProperty('--initial-rotation', newShape.initialRotation);
                        shapeContainer.style.setProperty('--intermediate-rotation', newShape.intermediateRotation);
                        shapeContainer.style.setProperty('--final-rotation', newShape.finalRotation);
                        
                        // Create the SVG element
                        const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                        svg.setAttribute('class', 'shape-svg');
                        const use = document.createElementNS('http://www.w3.org/2000/svg', 'use');
                        use.setAttributeNS('http://www.w3.org/1999/xlink', 'xlink:href', `#${newShape.type}`);
                        use.setAttribute('fill', newShape.color);
                        svg.appendChild(use);
                        shapeContainer.appendChild(svg);
                        
                        gameArea.appendChild(shapeContainer);
                    }
                }
                
                shapesToCount = generatedShapes.length;

                // Wait for the animation to complete before starting the timer
                setTimeout(() => {
                    isCountingPhase = true;
                    startTimer();
                    displayMessage("Count the shapes and enter your guess!");
                }, 1500); // Animation duration is 1.5s
            };

            const startTimer = () => {
                clearInterval(timerInterval); // Clear any existing timer
                timer = 4;
                timerDisplay.textContent = `Time: ${timer}s`;
                timerInterval = setInterval(() => {
                    timer--;
                    timerDisplay.textContent = `Time: ${timer}s`;
                    if (timer <= 0) {
                        clearInterval(timerInterval);
                        endGame("You ran out of time!");
                    }
                }, 1000);
            };

            const checkAnswer = () => {
                if (!isCountingPhase) {
                    displayMessage("Please wait for the shapes to appear.");
                    return;
                }

                const userGuess = parseInt(userGuessInput.value, 10);
                if (isNaN(userGuess)) {
                    displayMessage("Please enter a valid number.", '#FF6B6B');
                    return;
                }
                
                clearInterval(timerInterval); // Stop the timer on submit

                if (userGuess === shapesToCount) {
                    displayMessage(`Correct!`, '#5Dcb5A');
                    setTimeout(nextLevel, 2000);
                } else {
                    chances--;
                    updateUI();
                    displayMessage(`Incorrect. You have ${chances} chance(s) left.`, '#FF6B6B');
                    if (chances <= 0) {
                        endGame("You ran out of chances!");
                    } else {
                        // Restart timer for the next guess
                        startTimer();
                    }
                }
            };

            const nextLevel = () => {
                isCountingPhase = false;
                level++;
                if (level > 50) {
                    displayMessage("Congratulations! You have completed all 50 levels!");
                    gameOverScreen.querySelector('h2').textContent = "You Win!";
                    gameOverScreen.querySelector('p').textContent = "You've completed all 50 levels!";
                    endGame("You've completed all 50 levels!");
                    return;
                }
                userGuessInput.value = '';
                updateUI();
                displayMessage("Get ready for the next level!");
                setTimeout(generateShapes, 1500);
            };

            const updateUI = () => {
                levelDisplay.textContent = `Level: ${level}`;
                chancesDisplay.textContent = `Chances: ${chances}`;
                timerDisplay.textContent = `Time: ${timer}s`;
            };

            const endGame = (reason) => {
                gameActive = false;
                clearInterval(timerInterval);
                gameOverScreen.querySelector('p').textContent = reason;
                gameOverScreen.classList.remove('hidden');
                gameOverScreen.style.display = 'flex';
            };

            const startGame = () => {
                welcomeScreen.classList.add('hidden');
                gameScreen.classList.remove('hidden');
                level = 1;
                chances = 3;
                gameActive = true;
                gameOverScreen.style.display = 'none';
                updateUI();
                nextLevel();
            };

            const restartGame = () => {
                gameOverScreen.classList.add('hidden');
                startGame();
            };

            // Event Listeners
            startButton.addEventListener('click', startGame);
            submitButton.addEventListener('click', checkAnswer);
            restartButton.addEventListener('click', restartGame);

            userGuessInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    checkAnswer();
                }
            });
        });
    </script>
</body>
</html>
